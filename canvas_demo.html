<html>
<head>
<title>
  Image Resizer
</title>
<style>
  #imagePreview{
      height: 300px;
      width: 300px;
      display: block;
  }
</style>
<script src="jquery-1.11.3.js" type="text/javascript"></script>

<script>

	var canvas;
	var ctx;
	var MAX_WIDTH = 512;
    var MAX_HEIGHT = 512;
	
	var img;
	var w2;
	var h2;
	var img_x;
	var img_y;
	
	var crop_width = 72;
	var crop_height = 72;
	var crop_x;
	var crop_y;
	
	
	function decreaseSize(){
		var centerX = img_x + (w2/2);
		var centerY = img_y + (h2/2);
		
		var resizer = .9;
		w2 *= resizer;
		h2 *= resizer;
		
		img_x = centerX - (w2/2);
		img_y = centerY - (h2/2);
		
		drawCanvas();
	}
	
	function increaseSize(){
		// find center
		var centerX = img_x + (w2/2);
		var centerY = img_y + (h2/2);
		
		var resizer = 1/.9;
		w2 *= resizer;
		h2 *= resizer;
		
		img_x = centerX - (w2/2);
		img_y = centerY - (h2/2);
		
		drawCanvas();
	}
	
	function moveLeft(){
	   img_x -= (w2/30);
	   drawCanvas();	
	}
	function moveRight(){
		img_x += (w2/30);
		drawCanvas();
		
	}
	function moveUp(){
		img_y -= (h2/30);
		drawCanvas();
	}
	function moveDown(){
		img_y += (h2/30);
		drawCanvas();
		
	}
	
	function drawCanvas(){
		
		// gradient
		var grd = ctx.createLinearGradient(0,0,  0, MAX_HEIGHT  );
		grd.addColorStop(0, "rgb(100, 100, 100)");
		grd.addColorStop(1, "rgb(200, 100, 150)");
		
		ctx.fillStyle = grd;
		ctx.fillRect(0,0, MAX_WIDTH, MAX_HEIGHT);
		
		
		ctx.globalAlpha = 0.3;
		
		ctx.drawImage(img, img_x, img_y, w2, h2);
		
		ctx.globalAlpha = 1;
		
		// draw box around cropped area
		ctx.strokeRect(crop_x, crop_y, crop_width, crop_height );
		
		// funnest part ever
		// draw the part of the image that is inside the rectangle in side the rectangle
		
						// take distance from corner to edge and scale to image size
						//((w2-crop_x)/2)  * (img.width/w2);
		var imgCroppedX = ((crop_x-img_x)/w2) * img.width;
		var imgCroppedY = ((crop_y-img_y)/h2) * img.height;
		var imgCroppedWid = crop_width * (img.width / w2);
		var imgCroppedHei = crop_height * (img.height / h2);
		
		ctx.drawImage(img , imgCroppedX  ,  imgCroppedY ,  imgCroppedWid , imgCroppedHei , crop_x, crop_y, crop_width, crop_height  );
		
		
		var base64St = canvas.toDataURL("image/png");
        document.getElementById("imagePreview").src = base64St;
        document.getElementById("imagePreview").style.height = MAX_HEIGHT + "px";
        document.getElementById("imagePreview").style.width= MAX_WIDTH + "px";
		
		
	}

function imageUploaded()
{
	
   var file = $('#uploadImage').get(0);
   if(file.files[0].type.split("/")[0].toLowerCase() != "image"){
        alert("Incorrect file type -- Please ensure you are uploading an image file.");
   }
   if ( file.files && file.files[0] && file.files[0].type.split("/")[0].toLowerCase() === "image") {
        var FR = new FileReader();
        FR.onload = function(e) {
            var data = e.target.result;
            canvas = document.createElement("canvas");
            img = document.createElement("img");
            img.onload= function(){
			
				 var width = img.width;
                 var height = img.height;
                 w2 = width;
                 h2 = height;
				 
				  if (width > height) {
                     if (width > MAX_WIDTH) {
                        h2 = height * MAX_WIDTH / width;
                        w2 = MAX_WIDTH;
                    }
                 } else {
                     if (height > MAX_HEIGHT) {
                        w2 = width * MAX_HEIGHT / height;
                        h2 = MAX_HEIGHT;
                    }
                }
				
				img_x = (MAX_WIDTH-w2)/2;
				img_y = (MAX_HEIGHT-h2)/2;
				
				crop_x  =(MAX_WIDTH-crop_width)/2;
				crop_y  =(MAX_HEIGHT-crop_height)/2;
				 
				 canvas.width = MAX_WIDTH;
                 canvas.height = MAX_HEIGHT;
				 ctx = canvas.getContext("2d");
				 
				document.body.innerHTML += "<button onclick='decreaseSize()'>decrease size</button>"
				 + "<button onclick='increaseSize()'>increase size</button>"
				 + "<button onclick='moveLeft()'>move left</button>"
				 + "<button onclick='moveRight()'>move right</button>"
				 + "<button onclick='moveUp()'>move up</button>"
				 + "<button onclick='moveDown()'>move down</button>";
				
				
				drawCanvas();
				 
				 
              /*  ctx.drawImage(img, 0, 0, w2, h2);
                var base64St = canvas.toDataURL("image/png");
                document.getElementById("imagePreview").src = base64St;
                document.getElementById("imagePreview").style.height = MAX_HEIGHT + "px";
                document.getElementById("imagePreview").style.width= MAX_WIDTH + "px";*/
            }
            img.src = data;
        };  
        FR.readAsDataURL( file.files[0] );
   }
}
</script>

</head>

<body>
  <input type="file" name="uploadImage" id="uploadImage" onChange="imageUploaded()">
  <img id="imagePreview">
</body>


</html>
